version: '3.9'

services:
  backend:
    image: ghcr.io/axxdeveloper/cre-building-lease-os-backend:latest
    container_name: cre-backend
    restart: unless-stopped
    environment:
      SPRING_PROFILES_ACTIVE: fallback
      SERVER_PORT: 8080
    expose:
      - "8080"

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: cre-frontend
    restart: unless-stopped
    environment:
      # Server-side proxy target (frontend container -> backend container)
      API_BASE_URL: http://cre-backend:8080/api
      # Browser-side always call same-origin proxy
      NEXT_PUBLIC_API_BASE_URL_BROWSER: /api-proxy
      # Requested temporary password gate
      AUTH_PAGE_PASSWORD: "0910301562"
    depends_on:
      - backend
    expose:
      - "3000"

  nginx:
    image: nginx:1.27-alpine
    container_name: cre-nginx
    restart: unless-stopped
    depends_on:
      - frontend
    ports:
      - "80:80"
    volumes:
      - ./deploy/nginx/default.conf:/etc/nginx/conf.d/default.conf:ro
      - ./deploy/nginx/console.htpasswd:/etc/nginx/console.htpasswd:ro
